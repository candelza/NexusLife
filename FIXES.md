# การแก้ไขปัญหา Faith Nexus Hub

## ปัญหาที่แก้ไขแล้ว

### 1. การลบกลุ่มดูแลในหน้า Admin Settings
**ปัญหา:** ปุ่มลบกลุ่มดูแลไม่ทำงาน เหมือนเป็น mockup data
**การแก้ไข:**
- เพิ่มการยืนยันก่อนลบ (confirmation dialog)
- เพิ่มการตรวจสอบสิทธิ์ admin
- ปรับปรุง error handling และ logging
- เพิ่ม admin policies ในฐานข้อมูล
- เพิ่มการ refresh ข้อมูลหลังลบ

### 2. การเพิ่มพระคัมภีร์ประจำวัน
**ปัญหา:** ไม่สามารถตั้งวันที่และเวลาล่วงหน้าได้
**การแก้ไข:**
- เพิ่มฟิลด์ `scheduled_date` และ `scheduled_time` ในตาราง `bible_verses`
- เพิ่ม UI สำหรับเลือกวันที่และเวลาล่วงหน้า
- อัปเดตการแสดงผลในรายการพระคัมภีร์
- เพิ่มการแก้ไขวันที่และเวลาล่วงหน้าใน Dialog

### 3. การเข้าถึงหน้าเว็บไซต์
**ปัญหา:** หน้าเว็บไม่แสดงผลหลังสร้างคำอธิษฐาน
**การแก้ไข:**
- เพิ่มการ refresh ข้อมูลอัตโนมัติทุก 30 วินาที
- ปรับปรุงการ fetch ข้อมูลคำอธิษฐาน
- ตรวจสอบและแก้ไขการ build

## การเปลี่ยนแปลงในฐานข้อมูล

### Migration: `20250807030548_add_admin_policies.sql`
- เพิ่มฟิลด์ `member_level` ในตาราง `profiles`
- เพิ่มฟิลด์ `scheduled_date` และ `scheduled_time` ในตาราง `bible_verses`
- เพิ่ม admin policies สำหรับทุกตาราง:
  - `profiles`
  - `care_groups`
  - `group_members`
  - `prayers`
  - `prayer_responses`
  - `events`
  - `bible_verses`
  - `user_roles`

## การเปลี่ยนแปลงใน Frontend

### `src/pages/AdminSettings.tsx`
- ปรับปรุงฟังก์ชัน `handleDeleteCareGroup`
- เพิ่ม UI สำหรับวันที่และเวลาล่วงหน้าในพระคัมภีร์
- อัปเดต interface `BibleVerse`
- เพิ่มการแสดงผลวันที่และเวลาล่วงหน้า

### `src/pages/Dashboard.tsx`
- เพิ่มการ refresh ข้อมูลอัตโนมัติ
- ปรับปรุงการ fetch คำอธิษฐาน

## วิธีการใช้งาน

### การลบกลุ่มดูแล
1. เข้าไปที่หน้า Admin Settings
2. เลือกแท็บ "กลุ่มดูแล"
3. กดปุ่มไอคอนขยะ
4. ยืนยันการลบใน dialog
5. ข้อมูลจะถูกลบและรายการจะ refresh อัตโนมัติ

### การเพิ่มพระคัมภีร์ประจำวัน
1. เข้าไปที่หน้า Admin Settings
2. เลือกแท็บ "พระคัมภีร์ประจำวัน"
3. กรอกข้อมูลพระคัมภีร์
4. เลือกวันที่และเวลาล่วงหน้า (ถ้ามี)
5. กดปุ่ม "เพิ่มพระคัมภีร์ประจำวัน"

## หมายเหตุ
- ต้องมีสิทธิ์ admin ในการลบกลุ่มดูแล
- การลบกลุ่มดูแลจะลบสมาชิกในกลุ่มด้วย
- วันที่และเวลาล่วงหน้าสำหรับพระคัมภีร์เป็นตัวเลือก
- ข้อมูลจะ refresh อัตโนมัติทุก 30 วินาทีในหน้า Dashboard
